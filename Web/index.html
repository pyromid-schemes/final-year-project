<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Web Client Test</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css"/>
</head>
<body>
    <!-- Nav bar -->
    <!--<section id="header" class="align&#45;&#45;center background&#45;&#45;purps color&#45;&#45;white">-->
        <!--This is the nav bar-->
    <!--</section>-->

    <!-- Game canvas -->
    <section id="game-section">
        <div id="game"></div>

        <div id="sse">
            <!-- just debug for amount of times everything is redrawn -->
            <div id="redraws">Amount of redraws: <span id="redraw-count">0</span></div>
            <p>Please enter the host you are connecting to and open the websocket before you send a message.</p>
            <p>When you are finished, please close the WebSocket.</p>
            <p>Make sure you check the console for now so that you can see what is going on.</p>
            <input id="url" type="text" value="localhost"/>
            <input id="openWSButton" type="button" value="Open connection" onclick="openWebSocket(config);"/>
            <input id="closeWSButton" type="button" value="Close connection" onclick="closeWebSocket();" disabled/>
        </div>
    </section>

    <!-- Footer -->
    <section id="footer" class="align--center background--purps color--white">
        This is the footer
    </section>


    <!-- Include JS scripts after page DOM has loaded -->
    <script src="js/phaser/phaser.min.js"></script>

    <!-- ToDo: Compile these into one file? -->
    <script src="js/data/tilemaps.js"></script>
    <script src="js/data/rooms.js"></script>
    <script src="js/game.js"></script>
    <script src="js/map.js"></script>
    <script src="js/builder.js"></script>
    <script src="js/property.js"></script>


    <!-- Jamie's WebSockets script -->
    <script type="text/javascript" src="js/sockets/unityClient.js"></script>
    <script type="text/javascript" src="js/sockets/webSockets.js"></script>
    <script type="text/javascript" charset="UTF-8">
        var config = {
            "onOpen": function() {
                console.log("WebSocket opened.");
                document.getElementById("openWSButton").disabled = true;
                document.getElementById("closeWSButton").disabled = false;
            },
            "onMessage": {
                "worldStatus": function(msg) {
                    console.log("Server sent worldStatus message:");
                    for (var i = 0; i<msg.length;i++) {
                        console.log("Room: " + msg[i].objectId + ", xPos: " + msg[i].xPos + ", zPos: " + msg[i].zPos);
                    }
                },
                "vrPosition": function (msg) {
                    // By default (defined in Unity) this will be called 30x a second
                    console.log("Server sent vrPosition message:");
                    console.log("xPos: " + msg.xPos + ", zPos: " + msg.zPos);
                }
            },
            "onClose": function() {
                console.log("WebSocket closed.");
                document.getElementById("openWSButton").disabled = false;
                document.getElementById("closeWSButton").disabled = true;
            }
        };

        window.onload = function() {
            if ("WebSocket" in window) {
                console.log("WebSockets are available!");
            } else {
                alert("WebSockets are not supported in this browser");
            }
        };

    </script>
</body>
</html>
